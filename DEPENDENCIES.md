# STP Dependency Architecture

This document explains the dependency relationships in STP and the build strategy for maintaining a current, reliable SMT solver.

## Project Overview

**STP** (Simple Theorem Prover) is an SMT solver for bitvectors and arrays. It uses multiple SAT solvers as backends and integrates ABC for logic synthesis optimizations.

- **Repository**: [stp/stp](https://github.com/stp/stp)
- **Latest Release**: v2.3.4 (June 2024)
- **Maintainers**: @msoos (Mate Soos), @delcypher, @thomaslhunter

## Dependencies (Pinned Versions)

All dependencies are git submodules pinned to specific tested commits:

| Component | Submodule | Version/Commit | Source |
|-----------|-----------|----------------|--------|
| ABC | lib/extlib-abc | `95393064368b7c05da4d6f0264fc3419c175c7cb` | berkeley-abc/abc |
| CaDiCaL | deps/cadical | `16dde5487287b349d19eb9f16642a797e38ca34f` | meelgroup/cadical |
| Cadiback | deps/cadiback | branch `mccomp2024` | meelgroup/cadiback |
| CryptoMiniSat | deps/cryptominisat | tag `release/5.13.0` | msoos/cryptominisat |
| MiniSat | deps/minisat | latest | stp/minisat |
| GTest | deps/gtest | latest | stp/googletest |
| OutputCheck | deps/OutputCheck | latest | stp/OutputCheck |

## Build Commands

### Docker Build (Recommended)
```bash
docker build --tag stp/stp .
echo "(set-logic QF_BV)(check-sat)" | docker run --rm -i stp/stp
```

### Local Build
```bash
# Build dependencies (uses submodules)
./scripts/deps/setup-gtest.sh
./scripts/deps/setup-outputcheck.sh
./scripts/deps/setup-cms.sh
./scripts/deps/setup-minisat.sh

# Build STP
mkdir build && cd build
cmake .. -DSTATICCOMPILE=ON
cmake --build . --parallel
```

### Clean Commands
```bash
# Clean dependency builds
rm -rf deps/cadical/build deps/cadiback/*.{o,a} deps/cadiback/{makefile,config.hpp}
rm -rf deps/cryptominisat/build deps/minisat/build deps/gtest/build deps/install

# Clean STP build
rm -rf build
```

## Updating Dependencies

**IMPORTANT**: Do not update submodules without testing. The pinned versions are known to work together.

If updating is needed:
1. Update one submodule at a time
2. Run full build and test suite
3. Document the new commit in this file
4. Commit the submodule change

## Notes

- ABC is included as a submodule at a specific commit that predates the bundled CaDiCaL changes
- CaDiCaL is the meelgroup fork (not upstream arminbiere/cadical) required by Cadiback
- Cadiback's `config.hpp` is generated by the setup script since it needs git metadata
